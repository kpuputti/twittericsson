import urllib, logging
from django.utils import simplejson as json
from django.shortcuts import render_to_response
from django.http import HttpResponse
from django.contrib.sites.models import Site

def index(request):
    #domain = 'http://%s' % (Site.objects.get_current().domain)
    #logging.info('domain: ' + domain)
    
    #logging.info('req: ' + str(request))
    

    host = request.META.get('HTTP_HOST')

    return render_to_response('app/index.html', {'host': host})  


def update(request):
    logging.info('update!')
    #logging.info('request: ' + str(request))

    username = request.GET.get('username')
    password = request.GET.get('password')
    text = request.GET.get('text')
    lat = request.GET.get('lat')
    long = request.GET.get('long')

   
  #  logging.info('u: ' + str(user))
  #  logging.info(passwd)
  #  logging.info(text)
  #  logging.info(lat)
  #  logging.info(long)

    params = urllib.urlencode({'status': text, lat: lat, long: long})
    f = urllib.urlopen('http://' + str(username) + ':' + str(password) + '@twitter.com/statuses/update.json', params)
    
    response = f.read()
    logging.info('response: ' + response)
   
    return HttpResponse(response)


